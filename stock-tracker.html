<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockVue Elite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@0.1.1/dist/chartjs-chart-financial.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto+Slab:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
    <style>
        :root {
            --primary-color: #0ea5e9;
            --primary-light: #38bdf8;
            --primary-dark: #0284c7;
            --success-color: #10b981;
            --success-light: #34d399;
            --success-dark: #059669;
            --danger-color: #ef4444;
            --danger-light: #f87171;
            --danger-dark: #dc2626;
            --accent-color: #f59e0b;
            --accent-light: #fbbf24;
            --accent-dark: #d97706;
            
            --card-bg: #1e293b;
            --card-bg-lighter: #334155;
            --bg-color: #0f172a;
            --bg-color-lighter: #1e293b;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-tertiary: #94a3b8;
            --border-color: rgba(255, 255, 255, 0.08);
            
            --glass-bg: rgba(30, 41, 59, 0.8);
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --glass-blur: 10px;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(14, 165, 233, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(16, 185, 129, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 50% 50%, rgba(245, 158, 11, 0.03) 0%, transparent 40%);
            background-attachment: fixed;
        }
        
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            border-radius: 16px;
            position: relative;
            overflow: hidden;
        }
        
        .stock-card {
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            border-left: 4px solid transparent;
            background: var(--card-bg);
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }
        
        .stock-card:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 15px 30px -5px rgba(0, 0, 0, 0.4);
        }
        
        .stock-card.positive {
            border-left-color: var(--success-color);
        }
        
        .stock-card.negative {
            border-left-color: var(--danger-color);
        }
        
        .positive {
            color: var(--success-light);
        }
        
        .negative {
            color: var(--danger-light);
        }
        
        .shimmer {
            background: linear-gradient(90deg, rgba(30, 41, 59, 0.5) 25%, rgba(51, 65, 85, 0.5) 50%, rgba(30, 41, 59, 0.5) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.8s infinite;
            border-radius: 8px;
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(14, 165, 233, 0.4);
        }
        
        .btn-secondary {
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--text-secondary);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(5px);
        }
        
        .btn-secondary:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }
        
        .btn-accent {
            background: linear-gradient(135deg, var(--accent-color), var(--accent-dark));
            color: #fff;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .btn-accent:hover {
            background: linear-gradient(135deg, var(--accent-light), var(--accent-color));
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(245, 158, 11, 0.4);
        }
        
        .time-range-btn, .chart-type-btn {
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.05);
            background: rgba(255, 255, 255, 0.02);
            color: var(--text-tertiary);
        }
        
        .time-range-btn.active, .chart-type-btn.active {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
        }
        
        .time-range-btn:hover:not(.active), .chart-type-btn:hover:not(.active) {
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--text-secondary);
        }
        
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.6);
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(var(--primary-dark), var(--primary-color));
            border-radius: 10px;
        }
        
        @keyframes ticker {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        
        .ticker-content {
            animation: ticker 60s linear infinite;
        }
        
        .tooltip {
            position: absolute;
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            background: var(--card-bg);
            color: var(--text-primary);
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            margin-left: 0.75rem;
            z-index: 100;
            border: 1px solid var(--glass-border);
        }
        
        .tooltip-container:hover .tooltip {
            opacity: 1;
        }

        .sidebar-item {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sidebar-item.active {
            background-color: rgba(59, 130, 246, 0.2);
        }

        .news-item {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .news-item:hover {
            background-color: rgba(255, 255, 255, 0.02);
            transform: translateX(4px);
        }

        .section-hidden {
            display: none;
        }
    </style>
</head>
<body class="animate__animated animate__fadeIn">
    <div class="min-h-screen">
        <!-- Ticker -->
        <div class="bg-black py-2 overflow-hidden">
            <div class="ticker-content flex items-center space-x-8 whitespace-nowrap">
                <div class="flex items-center">
                    <span class="text-amber-400 font-medium mr-2">S&P 500</span>
                    <span class="text-green-400 font-semibold">4,783.35</span>
                    <span class="text-green-400 text-xs ml-1">+0.42%</span>
                </div>
                <div class="flex items-center">
                    <span class="text-amber-400 font-medium mr-2">NASDAQ</span>
                    <span class="text-green-400 font-semibold">16,742.39</span>
                    <span class="text-green-400 text-xs ml-1">+0.71%</span>
                </div>
                <div class="flex items-center">
                    <span class="text-amber-400 font-medium mr-2">DOW</span>
                    <span class="text-red-400 font-semibold">38,671.69</span>
                    <span class="text-red-400 text-xs ml-1">-0.13%</span>
                </div>
                <div class="flex items-center">
                    <span class="text-amber-400 font-medium mr-2">NIFTY</span>
                    <span class="text-green-400 font-semibold">22,055.70</span>
                    <span class="text-green-400 text-xs ml-1">+0.28%</span>
                </div>
                <div class="flex items-center">
                    <span class="text-amber-400 font-medium mr-2">BTC-USD</span>
                    <span class="text-green-400 font-semibold">63,245.78</span>
                    <span class="text-green-400 text-xs ml-1">+2.14%</span>
                </div>
            </div>
        </div>
        
        <!-- Header -->
        <header class="glass-card text-white py-8 shadow-lg relative overflow-hidden mx-4 mt-4">
            <div class="container mx-auto px-4">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="flex items-center mb-6 md:mb-0">
                        <div class="mr-4 bg-blue-500 bg-opacity-20 p-3 rounded-lg">
                            <i class="fas fa-chart-line text-2xl text-blue-400"></i>
                        </div>
                        <div>
                            <h1 class="text-3xl font-bold bg-gradient-to-r from-blue-400 to-amber-400 bg-clip-text text-transparent">
                                StockVue Elite
                            </h1>
                            <p class="text-blue-300 text-sm font-light tracking-wider">PREMIUM MARKET INTELLIGENCE</p>
                        </div>
                    </div>
                    
                    <div class="w-full md:w-2/5">
                        <div class="relative">
                            <input id="stockSearch" type="text" placeholder="Search stock symbol (e.g., AAPL, MSFT)" 
                                class="w-full py-3 px-5 rounded-lg bg-slate-800 text-white border border-slate-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                list="stockSuggestions">
                            <datalist id="stockSuggestions">
                                <option value="AAPL">Apple Inc.</option>
                                <option value="MSFT">Microsoft Corporation</option>
                                <option value="GOOGL">Alphabet Inc.</option>
                                <option value="AMZN">Amazon.com Inc.</option>
                                <option value="TSLA">Tesla Inc.</option>
                                <option value="META">Meta Platforms Inc.</option>
                                <option value="NVDA">NVIDIA Corporation</option>
                                <option value="JPM">JPMorgan Chase & Co.</option>
                            </datalist>
                            <button id="searchButton" class="absolute right-0 top-0 h-full px-5 bg-gradient-to-r from-blue-600 to-blue-500 text-white rounded-r-lg hover:from-blue-500 hover:to-blue-400 transition-all duration-300 flex items-center">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Quick access panels -->
                <div class="mt-8 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-3">
                    <div class="glass-card p-3 rounded-lg cursor-pointer hover:shadow-lg transition-all duration-300 transform hover:scale-105" data-symbol="AAPL">
                        <div class="flex justify-between items-center">
                            <span class="font-medium text-sm">AAPL</span>
                            <span class="text-green-400 text-xs">+1.2%</span>
                        </div>
                        <div class="text-lg font-bold mt-1">$175.34</div>
                    </div>
                    <div class="glass-card p-3 rounded-lg cursor-pointer hover:shadow-lg transition-all duration-300 transform hover:scale-105" data-symbol="MSFT">
                        <div class="flex justify-between items-center">
                            <span class="font-medium text-sm">MSFT</span>
                            <span class="text-green-400 text-xs">+0.8%</span>
                        </div>
                        <div class="text-lg font-bold mt-1">$415.22</div>
                    </div>
                    <div class="glass-card p-3 rounded-lg cursor-pointer hover:shadow-lg transition-all duration-300 transform hover:scale-105" data-symbol="GOOGL">
                        <div class="flex justify-between items-center">
                            <span class="font-medium text-sm">GOOGL</span>
                            <span class="text-red-400 text-xs">-0.5%</span>
                        </div>
                        <div class="text-lg font-bold mt-1">$142.38</div>
                    </div>
                    <div class="glass-card p-3 rounded-lg cursor-pointer hover:shadow-lg transition-all duration-300 transform hover:scale-105" data-symbol="AMZN">
                        <div class="flex justify-between items-center">
                            <span class="font-medium text-sm">AMZN</span>
                            <span class="text-green-400 text-xs">+1.5%</span>
                        </div>
                        <div class="text-lg font-bold mt-1">$178.92</div>
                    </div>
                    <div class="glass-card p-3 rounded-lg cursor-pointer hover:shadow-lg transition-all duration-300 transform hover:scale-105" data-symbol="TSLA">
                        <div class="flex justify-between items-center">
                            <span class="font-medium text-sm">TSLA</span>
                            <span class="text-red-400 text-xs">-2.1%</span>
                        </div>
                        <div class="text-lg font-bold mt-1">$240.76</div>
                    </div>
                </div>
            </div>
        </header>

        <main class="container mx-auto px-4 py-8">
            <!-- Sidebar Navigation -->
            <div class="fixed left-4 top-1/2 transform -translate-y-1/2 w-16 bg-slate-800 z-50 flex flex-col items-center py-8 rounded-2xl shadow-lg">
                <div class="flex flex-col items-center space-y-6">
                    <div class="sidebar-item active p-3 rounded-xl bg-blue-500 bg-opacity-20 text-blue-400 tooltip-container" data-section="dashboard">
                        <i class="fas fa-chart-line text-xl"></i>
                        <span class="tooltip">Dashboard</span>
                    </div>
                    <div class="sidebar-item p-3 rounded-xl hover:bg-slate-700 transition-all duration-300 tooltip-container" data-section="markets">
                        <i class="fas fa-globe text-xl"></i>
                        <span class="tooltip">Markets</span>
                    </div>
                    <div class="sidebar-item p-3 rounded-xl hover:bg-slate-700 transition-all duration-300 tooltip-container" data-section="comparison">
                        <i class="fas fa-chart-bar text-xl"></i>
                        <span class="tooltip">Comparison</span>
                    </div>
                    <div class="sidebar-item p-3 rounded-xl hover:bg-slate-700 transition-all duration-300 tooltip-container" data-section="portfolio">
                        <i class="fas fa-briefcase text-xl"></i>
                        <span class="tooltip">Portfolio</span>
                    </div>
                </div>
            </div>

            <div class="ml-20">
                <!-- Dashboard Section -->
                <div id="dashboard-section" class="dashboard-content">
                    <!-- Single Stock Chart -->
                    <div class="glass-card p-6 mb-8">
                        <div class="flex justify-between items-center mb-6">
                            <div>
                                <h2 class="text-2xl font-bold text-white flex items-center">
                                    <i class="fas fa-chart-line mr-3 text-blue-400"></i>
                                    <span id="currentStockTitle">AAPL - Apple Inc.</span>
                                    <button id="refreshButton" class="ml-3 bg-blue-500 bg-opacity-20 p-1 rounded-full text-blue-400 hover:bg-opacity-30 transition-all" title="Refresh Data">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                </h2>
                                <p class="text-gray-400 mt-1">Real-time stock analysis</p>
                            </div>
                            <div class="flex items-center space-x-4">
                                <div class="text-right">
                                    <div class="text-2xl font-bold text-white" id="currentPrice">$175.34</div>
                                    <div class="text-sm" id="currentChange">
                                        <span class="text-green-400">+2.14 (+1.23%)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center mb-4">
                            <div class="flex space-x-1 bg-slate-800 p-1 rounded-lg">
                                <button class="time-range-btn active px-3 py-1 rounded-md text-xs font-medium" data-range="1h">1H</button>
                                <button class="time-range-btn px-3 py-1 rounded-md text-xs font-medium" data-range="1d">1D</button>
                                <button class="time-range-btn px-3 py-1 rounded-md text-xs font-medium" data-range="1w">1W</button>
                                <button class="time-range-btn px-3 py-1 rounded-md text-xs font-medium" data-range="1m">1M</button>
                                <button class="time-range-btn px-3 py-1 rounded-md text-xs font-medium" data-range="6m">6M</button>
                                <button class="time-range-btn px-3 py-1 rounded-md text-xs font-medium" data-range="1y">1Y</button>
                            </div>
                            <div>
                                <select id="chartTypeSelector" class="bg-slate-800 text-white text-xs rounded-md px-3 py-1 border border-gray-700">
                                    <option value="line">Line Chart</option>
                                    <option value="candlestick">Candlestick Chart</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="h-96">
                            <canvas id="mainStockChart"></canvas>
                        </div>
                    </div>

                    <!-- News Section -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                        <div class="lg:col-span-2 glass-card p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-xl font-bold text-white flex items-center">
                                    <i class="fas fa-newspaper mr-2 text-blue-400"></i>
                                    Latest Market News
                                </h3>
                                <button id="refreshNews" class="btn-secondary px-3 py-1 rounded-full text-sm">
                                    <i class="fas fa-sync-alt mr-1"></i>Refresh
                                </button>
                            </div>
                            <div id="newsContainer" class="space-y-4 max-h-96 overflow-y-auto">
                                <!-- News items will be loaded here -->
                            </div>
                        </div>

                        <!-- Stock Details Panel -->
                        <div class="glass-card p-6">
                            <h3 class="text-xl font-bold text-white mb-4 flex items-center">
                                <i class="fas fa-info-circle mr-2 text-amber-400"></i>
                                Stock Details
                            </h3>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Market Cap</span>
                                    <span class="text-white font-semibold" id="detailMarketCap">$2.8T</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">P/E Ratio</span>
                                    <span class="text-white font-semibold" id="detailPE">28.5</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Volume</span>
                                    <span class="text-white font-semibold" id="detailVolume">58.0M</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">52W High</span>
                                    <span class="text-white font-semibold" id="detail52High">$198.23</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">52W Low</span>
                                    <span class="text-white font-semibold" id="detail52Low">$124.17</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Dividend Yield</span>
                                    <span class="text-white font-semibold" id="detailDividend">0.51%</span>
                                </div>
                            </div>
                            <button id="addToWatchlist" class="w-full mt-6 btn-primary px-4 py-2 rounded-lg text-sm font-medium">
                                <i class="fas fa-bookmark mr-2"></i>Add to Watchlist
                            </button>
                        </div>
                    </div>

                    <!-- Watchlist -->
                    <div class="glass-card p-6">
                        <div class="flex justify-between items-center mb-6">
                            <div class="flex items-center">
                                <div class="bg-blue-500 bg-opacity-20 p-2 rounded-lg mr-3">
                                    <i class="fas fa-bookmark text-blue-400"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-white">My Watchlist</h3>
                                    <p class="text-sm text-gray-400">Track your favorite stocks</p>
                                </div>
                            </div>
                        </div>
                        <div id="watchlistContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <!-- Watchlist items will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Markets Section -->
                <div id="markets-section" class="section-hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <!-- Market News -->
                        <div class="glass-card p-6">
                            <h3 class="text-xl font-bold text-white mb-6 flex items-center">
                                <i class="fas fa-globe mr-2 text-blue-400"></i>
                                Global Market News
                            </h3>
                            <div id="marketNewsContainer" class="space-y-4 max-h-96 overflow-y-auto">
                                <!-- Market news will be loaded here -->
                            </div>
                        </div>

                        <!-- Top Companies -->
                        <div class="glass-card p-6">
                            <h3 class="text-xl font-bold text-white mb-6 flex items-center">
                                <i class="fas fa-building mr-2 text-amber-400"></i>
                                Top Companies by Market Cap
                            </h3>
                            <div id="topCompaniesContainer" class="space-y-3 max-h-96 overflow-y-auto">
                                <!-- Top companies list will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Stock Market History -->
                    <div class="glass-card p-6">
                        <h3 class="text-xl font-bold text-white mb-6 flex items-center">
                            <i class="fas fa-history mr-2 text-green-400"></i>
                            Stock Market History & Facts
                        </h3>
                        <div id="marketHistoryContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <!-- Market history facts will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Comparison Section -->
                <div id="comparison-section" class="section-hidden">
                    <div class="flex justify-center mb-8">
                        <div class="glass-card p-6">
                            <h2 class="text-2xl font-bold text-white text-center flex items-center justify-center">
                                <i class="fas fa-exchange-alt mr-3 text-amber-400"></i>
                                Stock Comparison
                            </h2>
                            <p class="text-gray-400 text-center mt-1">Compare two stocks side by side</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <!-- Stock 1 -->
                        <div class="glass-card p-6">
                            <div class="mb-4">
                                <input id="compStockSearch1" type="text" placeholder="Enter symbol (e.g., AAPL)" 
                                    class="w-full py-2 px-4 rounded-lg bg-slate-800 text-white border border-slate-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    list="stockSuggestions">
                            </div>
                            
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold text-white" id="compStockSymbol1">AAPL</h3>
                                <div class="text-right">
                                    <div class="text-xl font-bold text-white" id="compPrice1">$175.34</div>
                                    <div class="text-sm text-green-400" id="compChange1">+1.23%</div>
                                </div>
                            </div>
                            
                            <div class="flex space-x-1 bg-slate-800 p-1 rounded-lg mb-4">
                                <button class="time-range-btn active px-3 py-1 rounded-md text-xs font-medium" data-chart="comp1" data-range="1h">1H</button>
                                <button class="time-range-btn px-3 py-1 rounded-md text-xs font-medium" data-chart="comp1" data-range="1d">1D</button>
                                <button class="time-range-btn px-3 py-1 rounded-md text-xs font-medium" data-chart="comp1" data-range="1w">1W</button>
                                <button class="time-range-btn px-3 py-1 rounded-md text-xs font-medium" data-chart="comp1" data-range="1m">1M</button>
                            </div>
                            
                            <div class="h-80">
                                <canvas id="comparisonChart1"></canvas>
                            </div>
                        </div>

                        <!-- Stock 2 -->
                        <div class="glass-card p-6">
                            <div class="mb-4">
                                <input id="compStockSearch2" type="text" placeholder="Enter symbol (e.g., MSFT)" 
                                    class="w-full py-2 px-4 rounded-lg bg-slate-800 text-white border border-slate-600 focus:outline-none focus:ring-2 focus:ring-amber-500"
                                    list="stockSuggestions">
                            </div>
                            
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold text-white" id="compStockSymbol2">MSFT</h3>
                                <div class="text-right">
                                    <div class="text-xl font-bold text-white" id="compPrice2">$415.22</div>
                                    <div class="text-sm text-green-400" id="compChange2">+0.8%</div>
                                </div>
                            </div>
                            
                            <div class="flex space-x-1 bg-slate-800 p-1 rounded-lg mb-4">
                                <button class="time-range-btn active px-3 py-1 rounded-md text-xs font-medium" data-chart="comp2" data-range="1h">1H</button>
                                <button class="time-range-btn px-3 py-1 rounded-md text-xs font-medium" data-chart="comp2" data-range="1d">1D</button>
                                <button class="time-range-btn px-3 py-1 rounded-md text-xs font-medium" data-chart="comp2" data-range="1w">1W</button>
                                <button class="time-range-btn px-3 py-1 rounded-md text-xs font-medium" data-chart="comp2" data-range="1m">1M</button>
                            </div>
                            
                            <div class="h-80">
                                <canvas id="comparisonChart2"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Comparison Table -->
                    <div class="glass-card p-6">
                        <h3 class="text-xl font-bold text-white mb-6 flex items-center">
                            <i class="fas fa-table mr-2 text-amber-400"></i>
                            Detailed Comparison
                        </h3>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-slate-700">
                                <thead>
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 tracking-wider">Metric</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-blue-400 tracking-wider" id="compTableHeader1">AAPL</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-amber-400 tracking-wider" id="compTableHeader2">MSFT</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 tracking-wider">Difference</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-slate-800 divide-y divide-slate-700">
                                    <tr class="hover:bg-slate-700 transition-colors duration-200">
                                        <td class="px-4 py-3 text-sm font-medium text-white">Current Price</td>
                                        <td class="px-4 py-3 text-sm text-white" id="compTablePrice1">$175.34</td>
                                        <td class="px-4 py-3 text-sm text-white" id="compTablePrice2">$415.22</td>
                                        <td class="px-4 py-3 text-sm text-green-400" id="compTablePriceDiff">+136.8%</td>
                                    </tr>
                                    <tr class="hover:bg-slate-700 transition-colors duration-200">
                                        <td class="px-4 py-3 text-sm font-medium text-white">Market Cap</td>
                                        <td class="px-4 py-3 text-sm text-white" id="compTableMCap1">$2.8T</td>
                                        <td class="px-4 py-3 text-sm text-white" id="compTableMCap2">$3.1T</td>
                                        <td class="px-4 py-3 text-sm text-green-400" id="compTableMCapDiff">+10.7%</td>
                                    </tr>
                                    <tr class="hover:bg-slate-700 transition-colors duration-200">
                                        <td class="px-4 py-3 text-sm font-medium text-white">Volume</td>
                                        <td class="px-4 py-3 text-sm text-white" id="compTableVol1">58.0M</td>
                                        <td class="px-4 py-3 text-sm text-white" id="compTableVol2">25.0M</td>
                                        <td class="px-4 py-3 text-sm text-red-400" id="compTableVolDiff">-56.9%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Portfolio Section -->
                <div id="portfolio-section" class="section-hidden">
                    <div class="flex justify-center mb-8">
                        <div class="glass-card p-6">
                            <h2 class="text-2xl font-bold text-white text-center flex items-center justify-center">
                                <i class="fas fa-briefcase mr-3 text-green-400"></i>
                                My Portfolio
                            </h2>
                            <p class="text-gray-400 text-center mt-1">Manage your investment interests</p>
                        </div>
                    </div>

                    <!-- Add Stock Form -->
                    <div class="glass-card p-6 mb-8">
                        <h3 class="text-xl font-bold text-white mb-6 flex items-center">
                            <i class="fas fa-plus mr-2 text-blue-400"></i>
                            Add Stock to Portfolio
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <input id="portfolioStockSymbol" type="text" placeholder="Stock Symbol (e.g., AAPL)" 
                                class="py-2 px-4 rounded-lg bg-slate-800 text-white border border-slate-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <input id="portfolioShares" type="number" placeholder="Number of Shares" 
                                class="py-2 px-4 rounded-lg bg-slate-800 text-white border border-slate-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <input id="portfolioBuyPrice" type="number" step="0.01" placeholder="Buy Price ($)" 
                                class="py-2 px-4 rounded-lg bg-slate-800 text-white border border-slate-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <button id="addToPortfolio" class="btn-primary px-6 py-2 rounded-lg font-medium">
                            <i class="fas fa-plus mr-2"></i>Add to Portfolio
                        </button>
                    </div>

                    <!-- Portfolio Holdings -->
                    <div class="glass-card p-6 mb-8">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-white flex items-center">
                                <i class="fas fa-chart-pie mr-2 text-amber-400"></i>
                                Portfolio Holdings
                            </h3>
                            <div class="text-right">
                                <div class="text-sm text-gray-400">Total Portfolio Value</div>
                                <div class="text-2xl font-bold text-white" id="totalPortfolioValue">$0.00</div>
                                <div class="text-sm" id="totalPortfolioChange">
                                    <span class="text-green-400">+$0.00 (0.00%)</span>
                                </div>
                            </div>
                        </div>
                        <div id="portfolioContainer" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Portfolio items will be loaded here -->
                        </div>
                    </div>

                    <!-- Portfolio Performance Chart -->
                    <div class="glass-card p-6">
                        <h3 class="text-xl font-bold text-white mb-6 flex items-center">
                            <i class="fas fa-chart-area mr-2 text-green-400"></i>
                            Portfolio Performance
                        </h3>
                        <div class="h-80">
                            <canvas id="portfolioChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer class="bg-gradient-to-r from-slate-800 to-slate-900 text-white py-8 mt-10">
            <div class="container mx-auto px-4 text-center">
                <div class="flex items-center justify-center mb-4">
                    <i class="fas fa-chart-line mr-2 text-blue-400"></i>
                    <span class="text-xl font-bold">StockVue Elite</span>
                </div>
                <p class="text-sm text-gray-400">This is a demo application. Stock data is simulated for demonstration purposes.</p>
                <p class="text-xs mt-2 text-gray-500">Â© 2024 StockVue Elite. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <script>
        // Global variables
        let mainChart, compChart1, compChart2, portfolioChart;
        let currentSymbol = 'AAPL';
        let compSymbol1 = 'AAPL';
        let compSymbol2 = 'MSFT';
        let watchlist = ['AAPL', 'MSFT', 'GOOGL', 'AMZN'];
        let portfolio = [];
        let currentSection = 'dashboard';
        
        // API Configuration
        const ALPHA_VANTAGE_API_KEY = 'demo'; // Replace with your Alpha Vantage API key
        const REFRESH_INTERVAL = 10000; // 10 seconds
        let refreshTimer;
        let chartType = 'line'; // Default chart type (line or candlestick)
        let validStockSymbols = new Set(['AAPL', 'MSFT', 'GOOGL', 'AMZN', 'TSLA', 'META', 'NVDA', 'JPM']); // To store validated stock symbols
        let topCompanies = []; // To store top companies by market cap

        // Stock data
        const stockInfo = {
            'AAPL': { name: 'Apple Inc.', basePrice: 175, marketCap: 2.8e12, volume: 58000000 },
            'MSFT': { name: 'Microsoft Corporation', basePrice: 415, marketCap: 3.1e12, volume: 25000000 },
            'GOOGL': { name: 'Alphabet Inc.', basePrice: 142, marketCap: 1.8e12, volume: 30000000 },
            'AMZN': { name: 'Amazon.com Inc.', basePrice: 178, marketCap: 1.85e12, volume: 40000000 },
            'TSLA': { name: 'Tesla Inc.', basePrice: 240, marketCap: 7.6e11, volume: 120000000 },
            'META': { name: 'Meta Platforms Inc.', basePrice: 325, marketCap: 8.4e11, volume: 22000000 },
            'NVDA': { name: 'NVIDIA Corporation', basePrice: 480, marketCap: 1.2e12, volume: 45000000 },
            'JPM': { name: 'JPMorgan Chase & Co.', basePrice: 152, marketCap: 4.4e11, volume: 12000000 }
        };

        // Mock news data
        const mockNews = [
            {
                title: "Apple's AI Revolution: New iPhone Features Transform User Experience",
                source: "TechCrunch",
                time: "2 hours ago",
                category: "Technology",
                url: "https://techcrunch.com/apple-ai-features"
            },
            {
                title: "Microsoft Cloud Revenue Surpasses Expectations in Q3 Results",
                source: "Reuters",
                time: "4 hours ago",
                category: "Earnings",
                url: "https://reuters.com/microsoft-cloud-revenue"
            },
            {
                title: "Tesla's Autopilot Technology Receives Major Safety Update",
                source: "Bloomberg",
                time: "6 hours ago",
                category: "Automotive",
                url: "https://bloomberg.com/tesla-autopilot-update"
            },
            {
                title: "Federal Reserve Considers Interest Rate Adjustments Amid Market Volatility",
                source: "Wall Street Journal",
                time: "8 hours ago",
                category: "Economy",
                url: "https://wsj.com/federal-reserve-rates"
            },
            {
                title: "NVIDIA's New AI Chips Drive Record Quarter Performance",
                source: "CNBC",
                time: "10 hours ago",
                category: "Technology",
                url: "https://cnbc.com/nvidia-ai-chips"
            }
        ];

        // Top companies data (based on market cap)
         topCompanies = [
            { symbol: "AAPL", name: "Apple Inc.", marketCap: "2.8T", change: "+1.2%" },
            { symbol: "MSFT", name: "Microsoft Corporation", marketCap: "3.1T", change: "+0.9%" },
            { symbol: "GOOGL", name: "Alphabet Inc.", marketCap: "1.8T", change: "-0.3%" },
            { symbol: "AMZN", name: "Amazon.com Inc.", marketCap: "1.85T", change: "+1.5%" },
            { symbol: "TSLA", name: "Tesla Inc.", marketCap: "0.76T", change: "+2.1%" },
            { symbol: "META", name: "Meta Platforms Inc.", marketCap: "0.84T", change: "-0.7%" },
            { symbol: "NVDA", name: "NVIDIA Corporation", marketCap: "1.2T", change: "+2.3%" },
            { symbol: "JPM", name: "JPMorgan Chase & Co.", marketCap: "0.44T", change: "+0.5%" }
        ];

        // Stock market history facts
        const marketFacts = [
            {
                title: "First Stock Exchange",
                description: "The Amsterdam Stock Exchange, established in 1602, was the world's first official stock market.",
                year: "1602"
            },
            {
                title: "Black Tuesday",
                description: "October 29, 1929 - The stock market crash that triggered the Great Depression.",
                year: "1929"
            },
            {
                title: "Dow Jones Created",
                description: "Charles Dow created the Dow Jones Industrial Average with just 12 companies.",
                year: "1896"
            },
            {
                title: "Electronic Trading",
                description: "NASDAQ became the first electronic stock exchange, revolutionizing trading.",
                year: "1971"
            },
            {
                title: "Circuit Breakers",
                description: "After Black Monday 1987, circuit breakers were introduced to halt trading during crashes.",
                year: "1987"
            },
            {
                title: "Longest Bull Market",
                description: "The bull market from 2009-2020 lasted 11 years, the longest in history.",
                year: "2009-2020"
            }
        ];

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Initializing StockVue Elite...');
            
            try {
                initializeCharts();
                setupEventListeners();
                loadDashboard();
                
                console.log('StockVue Elite initialized successfully');
            } catch (error) {
                console.error('Initialization error:', error);
            }
        });

        // Initialize charts
        function initializeCharts() {
            // Main dashboard chart
            const mainCtx = document.getElementById('mainStockChart').getContext('2d');
            mainChart = new Chart(mainCtx, createChartConfig('#3b82f6'));

            // Comparison charts
            const comp1Ctx = document.getElementById('comparisonChart1').getContext('2d');
            const comp2Ctx = document.getElementById('comparisonChart2').getContext('2d');
            compChart1 = new Chart(comp1Ctx, createChartConfig('#3b82f6'));
            compChart2 = new Chart(comp2Ctx, createChartConfig('#f59e0b'));

            // Portfolio chart
            const portfolioCtx = document.getElementById('portfolioChart').getContext('2d');
            portfolioChart = new Chart(portfolioCtx, createPortfolioChartConfig());
        }

        function createChartConfig(color) {
            return {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Price',
                        data: [],
                        borderColor: color,
                        backgroundColor: color + '20',
                        borderWidth: 2,
                        pointRadius: 0,
                        pointHoverRadius: 4,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(30, 41, 59, 0.9)',
                            titleColor: '#f8fafc',
                            bodyColor: '#cbd5e1',
                            borderColor: 'rgba(148, 163, 184, 0.2)',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: 'rgba(148, 163, 184, 0.1)', drawBorder: false },
                            ticks: { color: '#94a3b8', font: { size: 10 } }
                        },
                        y: {
                            grid: { color: 'rgba(148, 163, 184, 0.1)', drawBorder: false },
                            ticks: {
                                color: '#94a3b8',
                                font: { size: 10 },
                                callback: function(value) { return 
                         + value.toFixed(2); }
                            }
                        }
                    },
                    interaction: { intersect: false, mode: 'index' }
                }
            };
        }

        function createPortfolioChartConfig() {
            return {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Portfolio Value',
                        data: [],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 2,
                        pointRadius: 0,
                        pointHoverRadius: 4,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(30, 41, 59, 0.9)',
                            titleColor: '#f8fafc',
                            bodyColor: '#cbd5e1',
                            borderColor: 'rgba(148, 163, 184, 0.2)',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return 'Portfolio Value: '
                         + context.parsed.y.toLocaleString();
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: 'rgba(148, 163, 184, 0.1)', drawBorder: false },
                            ticks: { color: '#94a3b8', font: { size: 10 } }
                        },
                        y: {
                            grid: { color: 'rgba(148, 163, 184, 0.1)', drawBorder: false },
                            ticks: {
                                color: '#94a3b8',
                                font: { size: 10 },
                                callback: function(value) { 
                                    return 
                         + value.toLocaleString(); 
                                }
                            }
                        }
                    }
                }
            };
        }

        // Setup event listeners
        function setupEventListeners() {
            // Sidebar navigation
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.addEventListener('click', function() {
                    const section = this.dataset.section;
                    switchSection(section);
                });
            });

            // Main search
            const stockSearch = document.getElementById('stockSearch');
            stockSearch.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const symbol = this.value.trim().toUpperCase();
                    if (symbol) {
                        updateMainStock(symbol);
                    }
                }
            });

            // Quick access panels
            document.querySelectorAll('[data-symbol]').forEach(panel => {
                panel.addEventListener('click', function() {
                    const symbol = this.dataset.symbol;
                    updateMainStock(symbol);
                });
            });
            
            // Chart type selector
            const chartTypeSelector = document.getElementById('chartTypeSelector');
            chartTypeSelector.addEventListener('change', function() {
                chartType = this.value;
                const activeTimeRangeBtn = document.querySelector('.time-range-btn.active:not([data-chart])');
                const timeRange = activeTimeRangeBtn ? activeTimeRangeBtn.dataset.range : '1h';
                updateMainChartData(timeRange);
            });

            // Time range buttons for main chart
            document.querySelectorAll('.time-range-btn:not([data-chart])').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.time-range-btn:not([data-chart])').forEach(b => {
                        b.classList.remove('active');
                    });
                    this.classList.add('active');
                    updateMainChartData(this.dataset.range);
                });
            });

            // Comparison chart event listeners
            setupComparisonEventListeners();

            // Portfolio event listeners
            setupPortfolioEventListeners();

            // Add to watchlist
            document.getElementById('addToWatchlist').addEventListener('click', function() {
                if (currentSymbol && !watchlist.includes(currentSymbol)) {
                    watchlist.push(currentSymbol);
                    updateWatchlist();
                }
            });

            // Refresh news
            document.getElementById('refreshNews').addEventListener('click', function() {
                loadNews();
            });
        }

        function setupComparisonEventListeners() {
            // Comparison search inputs
            const compSearch1 = document.getElementById('compStockSearch1');
            const compSearch2 = document.getElementById('compStockSearch2');

            compSearch1.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const symbol = this.value.trim().toUpperCase();
                    if (symbol) {
                        updateComparisonStock(symbol, 1);
                    }
                }
            });

            compSearch2.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const symbol = this.value.trim().toUpperCase();
                    if (symbol) {
                        updateComparisonStock(symbol, 2);
                    }
                }
            });

            // Comparison time range buttons
            document.querySelectorAll('.time-range-btn[data-chart]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const chartId = this.dataset.chart;
                    document.querySelectorAll(`.time-range-btn[data-chart="${chartId}"]`).forEach(b => {
                        b.classList.remove('active');
                    });
                    this.classList.add('active');
                    updateComparisonChartData(chartId, this.dataset.range);
                });
            });
        }

        function setupPortfolioEventListeners() {
            document.getElementById('addToPortfolio').addEventListener('click', function() {
                const symbol = document.getElementById('portfolioStockSymbol').value.trim().toUpperCase();
                const shares = parseFloat(document.getElementById('portfolioShares').value);
                const buyPrice = parseFloat(document.getElementById('portfolioBuyPrice').value);

                if (symbol && shares > 0 && buyPrice > 0) {
                    addToPortfolio(symbol, shares, buyPrice);
                    // Clear form
                    document.getElementById('portfolioStockSymbol').value = '';
                    document.getElementById('portfolioShares').value = '';
                    document.getElementById('portfolioBuyPrice').value = '';
                }
            });
        }

        // Section switching
        function switchSection(section) {
            // Update sidebar
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active', 'bg-blue-500', 'bg-opacity-20', 'text-blue-400');
            });
            document.querySelector(`[data-section="${section}"]`).classList.add('active', 'bg-blue-500', 'bg-opacity-20', 'text-blue-400');

            // Hide all sections
            document.querySelectorAll('[id$="-section"]').forEach(sec => {
                sec.classList.add('section-hidden');
            });

            // Show selected section
            document.getElementById(section + '-section').classList.remove('section-hidden');
            currentSection = section;

            // Load section-specific data
            switch(section) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'markets':
                    loadMarketsSection();
                    break;
                case 'comparison':
                    loadComparisonSection();
                    break;
                case 'portfolio':
                    loadPortfolioSection();
                    break;
            }
        }

        // Dashboard functions
        function loadDashboard() {
            updateMainStock(currentSymbol);
            loadNews();
            updateWatchlist();
            
            // Add refresh button event listener
            document.getElementById('refreshButton').addEventListener('click', function() {
                refreshStockData();
            });
            
            // Start auto-refresh timer
            startRefreshTimer();
        }

        function updateMainStock(symbol) {
            // Validate the stock symbol
            if (!validStockSymbols.has(symbol)) {
                validateStockSymbol(symbol);
                return;
            }
            
            currentSymbol = symbol;
            const info = stockInfo[symbol] || { name: `${symbol} Inc.`, basePrice: 100 };
            
            // Update title and price
            document.getElementById('currentStockTitle').textContent = `${symbol} - ${info.name}`;
            
            // Try to fetch real-time data from Alpha Vantage
            fetchStockData(symbol)
                .then(data => {
                    if (data) {
                        // Update with real data
                        updateUIWithRealData(data);
                    } else {
                        // Fallback to mock data
                        updateUIWithMockData(symbol, info);
                    }
                })
                .catch(error => {
                    console.error('Error fetching stock data:', error);
                    // Fallback to mock data
                    updateUIWithMockData(symbol, info);
                });
            
            // Update chart
            updateMainChartData('1h');
        }
        
        function updateUIWithRealData(data) {
            // Update price and change
            const price = parseFloat(data.price);
            const previousClose = parseFloat(data.previousClose);
            const change = price - previousClose;
            const changePercent = (change / previousClose * 100);
            
            document.getElementById('currentPrice').textContent = `${price.toFixed(2)}`;
            
            const changeClass = change >= 0 ? 'text-green-400' : 'text-red-400';
            const changeSign = change >= 0 ? '+' : '';
            
            document.getElementById('currentChange').innerHTML = 
                `<span class="${changeClass}">${changeSign}${change.toFixed(2)} (${changeSign}${changePercent.toFixed(2)}%)</span>`;
            
            // Update details panel with real data
            document.getElementById('detailMarketCap').textContent = formatMarketCap(data.marketCap || stockInfo[currentSymbol].marketCap);
            document.getElementById('detailPE').textContent = data.pe ? data.pe.toFixed(2) : 'N/A';
            document.getElementById('detailVolume').textContent = formatVolume(data.volume || stockInfo[currentSymbol].volume);
            document.getElementById('detail52High').textContent = data.high52Week ? `$${data.high52Week.toFixed(2)}` : `$${(stockInfo[currentSymbol].basePrice * 1.3).toFixed(2)}`;
            document.getElementById('detail52Low').textContent = data.low52Week ? `$${data.low52Week.toFixed(2)}` : `$${(stockInfo[currentSymbol].basePrice * 0.7).toFixed(2)}`;
            document.getElementById('detailDividend').textContent = data.dividendYield ? `${data.dividendYield.toFixed(2)}%` : `${(Math.random() * 3).toFixed(2)}%`;
        }
        
        function updateUIWithMockData(symbol, info) {
            // Generate random change
            const change = (Math.random() - 0.5) * 10;
            const changePercent = (change / info.basePrice * 100).toFixed(2);
            const changeClass = change >= 0 ? 'text-green-400' : 'text-red-400';
            const changeSign = change >= 0 ? '+' : '';
            
            document.getElementById('currentPrice').textContent = `${info.basePrice.toFixed(2)}`;
            document.getElementById('currentChange').innerHTML = 
                `<span class="${changeClass}">${changeSign}${change.toFixed(2)} (${changeSign}${changePercent}%)</span>`;

            // Update details panel
            updateStockDetails(symbol, info);
        }
        
        async function validateStockSymbol(symbol) {
            try {
                const response = await fetch(`https://www.alphavantage.co/query?function=SYMBOL_SEARCH&keywords=${symbol}&apikey=${ALPHA_VANTAGE_API_KEY}`);
                const data = await response.json();
                
                if (data.bestMatches && data.bestMatches.length > 0) {
                    // Found a valid symbol
                    const match = data.bestMatches[0];
                    const validSymbol = match['1. symbol'];
                    const name = match['2. name'];
                    
                    // Add to valid symbols set
                    validStockSymbols.add(validSymbol);
                    
                    // Add to stockInfo if not exists
                    if (!stockInfo[validSymbol]) {
                        stockInfo[validSymbol] = {
                            name: name,
                            basePrice: 100 + Math.random() * 200,
                            marketCap: Math.random() * 1e12,
                            volume: Math.random() * 10000000
                        };
                    }
                    
                    // Update the stock display
                    updateMainStock(validSymbol);
                } else {
                    alert(`Invalid stock symbol: ${symbol}. Please try another symbol.`);
                }
            } catch (error) {
                console.error('Error validating stock symbol:', error);
                alert(`Error validating stock symbol: ${symbol}. Please try another symbol.`);
            }
        }
        
        async function fetchStockData(symbol) {
            try {
                // Global quote for current price and change
                const response = await fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${symbol}&apikey=${ALPHA_VANTAGE_API_KEY}`);
                const data = await response.json();
                
                if (data['Global Quote']) {
                    const quote = data['Global Quote'];
                    return {
                        price: quote['05. price'],
                        previousClose: quote['08. previous close'],
                        change: quote['09. change'],
                        changePercent: quote['10. change percent'],
                        volume: parseInt(quote['06. volume']),
                        // Other fields would need additional API calls
                        marketCap: stockInfo[symbol].marketCap,
                        pe: null,
                        high52Week: null,
                        low52Week: null,
                        dividendYield: null
                    };
                }
                return null;
            } catch (error) {
                console.error('Error fetching stock data:', error);
                return null;
            }
        }
        
        function refreshStockData() {
            // Show refresh animation
            const refreshButton = document.getElementById('refreshButton');
            refreshButton.classList.add('animate-spin');
            
            // Fetch fresh data
            updateMainStock(currentSymbol);
            
            // Stop animation after 1 second
            setTimeout(() => {
                refreshButton.classList.remove('animate-spin');
            }, 1000);
        }
        
        function startRefreshTimer() {
            // Clear any existing timer
            if (refreshTimer) {
                clearInterval(refreshTimer);
            }
            
            // Set up new timer
            refreshTimer = setInterval(() => {
                refreshStockData();
            }, REFRESH_INTERVAL);
        }

        function updateStockDetails(symbol, info) {
            document.getElementById('detailMarketCap').textContent = formatMarketCap(info.marketCap);
            document.getElementById('detailPE').textContent = (Math.random() * 30 + 5).toFixed(1);
            document.getElementById('detailVolume').textContent = formatVolume(info.volume);
            document.getElementById('detail52High').textContent = `${(info.basePrice * 1.3).toFixed(2)}`;
            document.getElementById('detail52Low').textContent = `${(info.basePrice * 0.7).toFixed(2)}`;
            document.getElementById('detailDividend').textContent = `${(Math.random() * 3).toFixed(2)}%`;
        }

        function updateMainChartData(timeRange) {
            // Get the current chart type
            const chartTypeSelector = document.getElementById('chartTypeSelector');
            chartType = chartTypeSelector.value;
            
            if (chartType === 'line') {
                // Line chart data
                const chartData = generateChartData(currentSymbol, timeRange);
                
                // Update chart configuration if needed
                if (mainChart.config.type !== 'line') {
                    // Destroy and recreate as line chart
                    mainChart.destroy();
                    const ctx = document.getElementById('mainStockChart').getContext('2d');
                    mainChart = new Chart(ctx, createChartConfig());
                }
                
                mainChart.data.labels = chartData.labels;
                mainChart.data.datasets[0].data = chartData.prices;
                mainChart.update('none');
            } else if (chartType === 'candlestick') {
                // Candlestick chart data
                const candlestickData = generateCandlestickData(currentSymbol, timeRange);
                
                // Update chart configuration if needed
                if (mainChart.config.type !== 'candlestick') {
                    // Destroy and recreate as candlestick chart
                    mainChart.destroy();
                    const ctx = document.getElementById('mainStockChart').getContext('2d');
                    mainChart = new Chart(ctx, createCandlestickChartConfig());
                }
                
                mainChart.data.datasets[0].data = candlestickData;
                mainChart.update('none');
            }
        }
        
        function generateCandlestickData(symbol, timeRange) {
            // Generate mock candlestick data
            const basePrice = stockInfo[symbol].basePrice;
            const volatility = basePrice * 0.02; // 2% volatility
            const data = [];
            
            let numPoints;
            switch (timeRange) {
                case '1h': numPoints = 60; break; // 1-minute intervals
                case '1d': numPoints = 24; break; // hourly intervals
                case '1w': numPoints = 7; break;  // daily intervals
                case '1m': numPoints = 30; break; // daily intervals
                case '6m': numPoints = 24; break; // weekly intervals
                case '1y': numPoints = 52; break; // weekly intervals
                default: numPoints = 24;
            }
            
            let currentPrice = basePrice;
            const now = new Date();
            
            for (let i = 0; i < numPoints; i++) {
                // Calculate time for this candle
                let date;
                switch (timeRange) {
                    case '1h':
                        date = new Date(now.getTime() - (numPoints - i) * 60 * 1000);
                        break;
                    case '1d':
                        date = new Date(now.getTime() - (numPoints - i) * 60 * 60 * 1000);
                        break;
                    case '1w':
                        date = new Date(now.getTime() - (numPoints - i) * 24 * 60 * 60 * 1000);
                        break;
                    case '1m':
                        date = new Date(now.getTime() - (numPoints - i) * 24 * 60 * 60 * 1000);
                        break;
                    case '6m':
                        date = new Date(now.getTime() - (numPoints - i) * 7 * 24 * 60 * 60 * 1000);
                        break;
                    case '1y':
                        date = new Date(now.getTime() - (numPoints - i) * 7 * 24 * 60 * 60 * 1000);
                        break;
                }
                
                // Generate random price movements
                const open = currentPrice;
                const close = open + (Math.random() - 0.5) * volatility * 2;
                const high = Math.max(open, close) + Math.random() * volatility;
                const low = Math.min(open, close) - Math.random() * volatility;
                
                // Add candle data
                data.push({
                    x: date,
                    o: open,
                    h: high,
                    l: low,
                    c: close
                });
                
                currentPrice = close;
            }
            
            return data;
        }
        
        function createCandlestickChartConfig() {
            return {
                type: 'candlestick',
                data: {
                    datasets: [{
                        label: currentSymbol,
                        data: []
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'day',
                                displayFormats: {
                                    day: 'MMM d'
                                }
                            },
                            grid: { color: 'rgba(148, 163, 184, 0.1)', drawBorder: false },
                            ticks: { color: '#94a3b8', font: { size: 10 } }
                        },
                        y: {
                            grid: { color: 'rgba(148, 163, 184, 0.1)', drawBorder: false },
                            ticks: {
                                color: '#94a3b8',
                                font: { size: 10 },
                                callback: function(value) { return '$' + value.toFixed(2); }
                            }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(30, 41, 59, 0.9)',
                            titleColor: '#f8fafc',
                            bodyColor: '#cbd5e1',
                            borderColor: 'rgba(148, 163, 184, 0.2)',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    const point = context.raw;
                                    return [
                                        `Open: $${point.o.toFixed(2)}`,
                                        `High: $${point.h.toFixed(2)}`,
                                        `Low: $${point.l.toFixed(2)}`,
                                        `Close: $${point.c.toFixed(2)}`
                                    ];
                                }
                            }
                        }
                    }
                }
            };
        }

        function loadNews() {
            const newsContainer = document.getElementById('newsContainer');
            newsContainer.innerHTML = '';

            // Add some loading shimmer
            for (let i = 0; i < 3; i++) {
                const shimmer = document.createElement('div');
                shimmer.className = 'shimmer h-20 mb-4';
                newsContainer.appendChild(shimmer);
            }

            // Simulate API delay
            setTimeout(() => {
                newsContainer.innerHTML = '';
                mockNews.forEach(news => {
                    const newsItem = createNewsItem(news);
                    newsContainer.appendChild(newsItem);
                });
            }, 800);
        }

        function createNewsItem(news) {
            const item = document.createElement('div');
            item.className = 'news-item glass-card p-4 rounded-lg';
            item.innerHTML = `
                <div class="flex justify-between items-start mb-2">
                    <span class="text-xs text-blue-400 bg-blue-500 bg-opacity-20 px-2 py-1 rounded">${news.category}</span>
                    <span class="text-xs text-gray-400">${news.time}</span>
                </div>
                <h4 class="text-white font-semibold mb-2 line-clamp-2">${news.title}</h4>
                <div class="flex justify-between items-center">
                    <span class="text-sm text-gray-400">${news.source}</span>
                    <i class="fas fa-external-link-alt text-gray-400 text-xs"></i>
                </div>
            `;
            
            item.addEventListener('click', () => {
                window.open(news.url, '_blank');
            });
            
            return item;
        }

        function updateWatchlist() {
            const container = document.getElementById('watchlistContainer');
            container.innerHTML = '';

            watchlist.forEach(symbol => {
                const stockData = generateMockStockData(symbol);
                const card = createWatchlistCard(stockData);
                container.appendChild(card);
            });
        }

        function createWatchlistCard(data) {
            const card = document.createElement('div');
            const changeClass = data.change >= 0 ? 'positive' : 'negative';
            const changeIcon = data.change >= 0 ? 'fa-arrow-up' : 'fa-arrow-down';
            
            card.className = `stock-card ${changeClass} glass-card p-4 cursor-pointer hover:shadow-lg transition-all duration-300`;
            card.innerHTML = `
                <div class="flex justify-between items-start mb-3">
                    <div>
                        <h4 class="font-semibold text-white">${data.companyName}</h4>
                        <p class="text-sm text-gray-400">${data.symbol}</p>
                    </div>
                    <button class="remove-watchlist text-gray-400 hover:text-red-400 transition-colors">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="flex justify-between items-end">
                    <span class="text-lg font-bold text-white">${data.price.toFixed(2)}</span>
                    <div class="text-right">
                        <div class="text-sm font-medium ${changeClass}">
                            <i class="fas ${changeIcon} mr-1"></i>
                            ${data.change >= 0 ? '+' : ''}${data.change.toFixed(2)}
                        </div>
                        <div class="text-xs ${changeClass}">
                            ${data.changePercent >= 0 ? '+' : ''}${data.changePercent.toFixed(2)}%
                        </div>
                    </div>
                </div>
            `;
            
            // Add click handler for the card
            card.addEventListener('click', function(e) {
                if (!e.target.closest('.remove-watchlist')) {
                    updateMainStock(data.symbol);
                }
            });
            
            // Add remove handler
            const removeBtn = card.querySelector('.remove-watchlist');
            removeBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                watchlist = watchlist.filter(s => s !== data.symbol);
                updateWatchlist();
            });
            
            return card;
        }

        // Markets section functions
        function loadMarketsSection() {
            loadMarketNews();
            loadTopCompanies();
            loadMarketHistory();
        }

        function loadMarketNews() {
            const container = document.getElementById('marketNewsContainer');
            container.innerHTML = '';

            // Extended market news
            const marketNews = [
                ...mockNews,
                {
                    title: "Global Markets Rally as Inflation Concerns Ease",
                    source: "Financial Times",
                    time: "1 hour ago",
                    category: "Markets",
                    url: "https://ft.com/markets-rally"
                },
                {
                    title: "Cryptocurrency Market Shows Signs of Recovery",
                    source: "CoinDesk",
                    time: "3 hours ago",
                    category: "Crypto",
                    url: "https://coindesk.com/crypto-recovery"
                },
                {
                    title: "European Central Bank Maintains Current Interest Rates",
                    source: "Reuters",
                    time: "5 hours ago",
                    category: "Economy",
                    url: "https://reuters.com/ecb-rates"
                }
            ];

            marketNews.forEach(news => {
                const newsItem = createNewsItem(news);
                container.appendChild(newsItem);
            });
        }

        function loadTopCompanies() {
            const container = document.getElementById('topCompaniesContainer');
            container.innerHTML = '';

            topCompanies.forEach((company, index) => {
                const companyCard = document.createElement('div');
                const changeClass = company.change.startsWith('+') ? 'text-green-400' : 'text-red-400';
                
                companyCard.className = 'glass-card p-3 rounded-lg hover:bg-slate-700 transition-colors duration-300 cursor-pointer';
                companyCard.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-amber-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-3">
                                ${index + 1}
                            </div>
                            <div>
                                <div class="font-semibold text-white text-sm">${company.name}</div>
                                <div class="text-xs text-gray-400">${company.symbol}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-white text-sm">${company.marketCap}</div>
                            <div class="text-xs ${changeClass}">${company.change}</div>
                        </div>
                    </div>
                `;
                
                // Add click handler to load the stock data when clicked
                companyCard.addEventListener('click', () => {
                    updateMainStock(company.symbol);
                    // Switch to dashboard section to show the stock
                    document.querySelectorAll('.section-tab').forEach(tab => tab.classList.remove('active'));
                    document.querySelector('[data-section="dashboard"]').classList.add('active');
                    document.querySelectorAll('.section').forEach(section => section.classList.add('section-hidden'));
                    document.getElementById('dashboard-section').classList.remove('section-hidden');
                    currentSection = 'dashboard';
                });
                
                container.appendChild(companyCard);
            });
        }

        function loadMarketHistory() {
            const container = document.getElementById('marketHistoryContainer');
            container.innerHTML = '';

            marketFacts.forEach(fact => {
                const factCard = document.createElement('div');
                factCard.className = 'glass-card p-4 rounded-lg hover:bg-slate-700 transition-colors duration-300';
                factCard.innerHTML = `
                    <div class="text-center mb-3">
                        <div class="text-2xl font-bold text-amber-400">${fact.year}</div>
                    </div>
                    <h4 class="font-semibold text-white mb-2">${fact.title}</h4>
                    <p class="text-sm text-gray-300">${fact.description}</p>
                `;
                
                container.appendChild(factCard);
            });
        }

        // Comparison section functions
        function loadComparisonSection() {
            updateComparisonStock(compSymbol1, 1);
            updateComparisonStock(compSymbol2, 2);
            updateComparisonTable();
        }

        function updateComparisonStock(symbol, chartIndex) {
            if (chartIndex === 1) {
                compSymbol1 = symbol;
                document.getElementById('compStockSymbol1').textContent = symbol;
                document.getElementById('compTableHeader1').textContent = symbol;
            } else {
                compSymbol2 = symbol;
                document.getElementById('compStockSymbol2').textContent = symbol;
                document.getElementById('compTableHeader2').textContent = symbol;
            }

            const info = stockInfo[symbol] || { basePrice: 100 };
            const change = (Math.random() - 0.5) * 10;
            const changePercent = (change / info.basePrice * 100).toFixed(2);
            const changeClass = change >= 0 ? 'text-green-400' : 'text-red-400';

            document.getElementById(`compPrice${chartIndex}`).textContent = `${info.basePrice.toFixed(2)}`;
            document.getElementById(`compChange${chartIndex}`).textContent = `${changePercent >= 0 ? '+' : ''}${changePercent}%`;
            document.getElementById(`compChange${chartIndex}`).className = `text-sm ${changeClass}`;

            updateComparisonChartData(`comp${chartIndex}`, '1h');
        }

        function updateComparisonChartData(chartId, timeRange) {
            const symbol = chartId === 'comp1' ? compSymbol1 : compSymbol2;
            const chart = chartId === 'comp1' ? compChart1 : compChart2;
            const chartData = generateChartData(symbol, timeRange);
            
            chart.data.labels = chartData.labels;
            chart.data.datasets[0].data = chartData.prices;
            chart.update('none');
        }

        function updateComparisonTable() {
            const info1 = stockInfo[compSymbol1] || { basePrice: 100, marketCap: 1e10, volume: 1000000 };
            const info2 = stockInfo[compSymbol2] || { basePrice: 100, marketCap: 1e10, volume: 1000000 };

            // Update prices
            const priceDiff = ((info2.basePrice - info1.basePrice) / info1.basePrice * 100).toFixed(1);
            document.getElementById('compTablePrice1').textContent = `${info1.basePrice.toFixed(2)}`;
            document.getElementById('compTablePrice2').textContent = `${info2.basePrice.toFixed(2)}`;
            document.getElementById('compTablePriceDiff').textContent = `${priceDiff > 0 ? '+' : ''}${priceDiff}%`;
            document.getElementById('compTablePriceDiff').className = `px-4 py-3 text-sm ${priceDiff > 0 ? 'text-green-400' : 'text-red-400'}`;

            // Update market cap
            const mcapDiff = ((info2.marketCap - info1.marketCap) / info1.marketCap * 100).toFixed(1);
            document.getElementById('compTableMCap1').textContent = formatMarketCap(info1.marketCap);
            document.getElementById('compTableMCap2').textContent = formatMarketCap(info2.marketCap);
            document.getElementById('compTableMCapDiff').textContent = `${mcapDiff > 0 ? '+' : ''}${mcapDiff}%`;
            document.getElementById('compTableMCapDiff').className = `px-4 py-3 text-sm ${mcapDiff > 0 ? 'text-green-400' : 'text-red-400'}`;

            // Update volume
            const volDiff = ((info2.volume - info1.volume) / info1.volume * 100).toFixed(1);
            document.getElementById('compTableVol1').textContent = formatVolume(info1.volume);
            document.getElementById('compTableVol2').textContent = formatVolume(info2.volume);
            document.getElementById('compTableVolDiff').textContent = `${volDiff > 0 ? '+' : ''}${volDiff}%`;
            document.getElementById('compTableVolDiff').className = `px-4 py-3 text-sm ${volDiff > 0 ? 'text-green-400' : 'text-red-400'}`;
        }

        // Portfolio section functions
        function loadPortfolioSection() {
            updatePortfolioDisplay();
            updatePortfolioChart();
        }

        function addToPortfolio(symbol, shares, buyPrice) {
            const existingIndex = portfolio.findIndex(item => item.symbol === symbol);
            
            if (existingIndex >= 0) {
                // Update existing holding
                const existing = portfolio[existingIndex];
                const totalShares = existing.shares + shares;
                const totalCost = (existing.shares * existing.buyPrice) + (shares * buyPrice);
                existing.shares = totalShares;
                existing.buyPrice = totalCost / totalShares; // Average cost
            } else {
                // Add new holding
                portfolio.push({
                    symbol: symbol,
                    shares: shares,
                    buyPrice: buyPrice,
                    companyName: stockInfo[symbol]?.name || `${symbol} Inc.`
                });
            }
            
            updatePortfolioDisplay();
            updatePortfolioChart();
        }

        function removeFromPortfolio(symbol) {
            portfolio = portfolio.filter(item => item.symbol !== symbol);
            updatePortfolioDisplay();
            updatePortfolioChart();
        }

        function updatePortfolioDisplay() {
            const container = document.getElementById('portfolioContainer');
            container.innerHTML = '';

            let totalValue = 0;
            let totalCost = 0;

            portfolio.forEach(holding => {
                const currentPrice = (stockInfo[holding.symbol]?.basePrice || 100) + (Math.random() - 0.5) * 10;
                const currentValue = holding.shares * currentPrice;
                const cost = holding.shares * holding.buyPrice;
                const gainLoss = currentValue - cost;
                const gainLossPercent = (gainLoss / cost) * 100;

                totalValue += currentValue;
                totalCost += cost;

                const holdingCard = createPortfolioCard(holding, currentPrice, gainLoss, gainLossPercent);
                container.appendChild(holdingCard);
            });

            // Update total portfolio value
            const totalGainLoss = totalValue - totalCost;
            const totalGainLossPercent = totalCost > 0 ? (totalGainLoss / totalCost) * 100 : 0;

            document.getElementById('totalPortfolioValue').textContent = `${totalValue.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            
            const changeClass = totalGainLoss >= 0 ? 'text-green-400' : 'text-red-400';
            document.getElementById('totalPortfolioChange').innerHTML = 
                `<span class="${changeClass}">${totalGainLoss >= 0 ? '+' : ''}${Math.abs(totalGainLoss).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})} (${totalGainLossPercent.toFixed(2)}%)</span>`;
        }

        function createPortfolioCard(holding, currentPrice, gainLoss, gainLossPercent) {
            const card = document.createElement('div');
            const changeClass = gainLoss >= 0 ? 'text-green-400' : 'text-red-400';
            const borderClass = gainLoss >= 0 ? 'border-green-500' : 'border-red-500';
            
            card.className = `glass-card p-4 rounded-lg border-l-4 ${borderClass} hover:shadow-lg transition-all duration-300`;
            card.innerHTML = `
                <div class="flex justify-between items-start mb-3">
                    <div>
                        <h4 class="font-semibold text-white">${holding.companyName}</h4>
                        <p class="text-sm text-gray-400">${holding.symbol} â¢ ${holding.shares} shares</p>
                    </div>
                    <button class="remove-portfolio text-gray-400 hover:text-red-400 transition-colors" data-symbol="${holding.symbol}">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                <div class="grid grid-cols-2 gap-2 text-sm mb-3">
                    <div>
                        <span class="text-gray-400">Buy Price:</span>
                        <div class="font-semibold text-white">${holding.buyPrice.toFixed(2)}</div>
                    </div>
                    <div>
                        <span class="text-gray-400">Current:</span>
                        <div class="font-semibold text-white">${currentPrice.toFixed(2)}</div>
                    </div>
                </div>
                <div class="flex justify-between items-end">
                    <div>
                        <span class="text-gray-400 text-xs">Current Value</span>
                        <div class="font-bold text-white">${(holding.shares * currentPrice).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                    </div>
                    <div class="text-right">
                        <div class="font-semibold ${changeClass}">
                            ${gainLoss >= 0 ? '+' : ''}${Math.abs(gainLoss).toFixed(2)}
                        </div>
                        <div class="text-xs ${changeClass}">
                            ${gainLossPercent >= 0 ? '+' : ''}${gainLossPercent.toFixed(2)}%
                        </div>
                    </div>
                </div>
            `;

            // Add remove handler
            const removeBtn = card.querySelector('.remove-portfolio');
            removeBtn.addEventListener('click', function() {
                removeFromPortfolio(this.dataset.symbol);
            });

            return card;
        }

        function updatePortfolioChart() {
            // Generate mock portfolio performance data
            const labels = [];
            const data = [];
            const baseValue = portfolio.reduce((sum, holding) => sum + (holding.shares * holding.buyPrice), 0);
            
            for (let i = 30; i >= 0; i--) {
                const date = new Date(Date.now() - i * 24 * 60 * 60 * 1000);
                labels.push(date.toLocaleDateString([], { month: 'short', day: 'numeric' }));
                
                const fluctuation = 1 + (Math.random() - 0.5) * 0.1; // Â±5% daily fluctuation
                const value = baseValue * fluctuation * (1 + (30 - i) * 0.01); // Growth trend
                data.push(value);
            }

            portfolioChart.data.labels = labels;
            portfolioChart.data.datasets[0].data = data;
            portfolioChart.update('none');
        }

        // Utility functions
        function generateChartData(symbol, timeRange) {
            const info = stockInfo[symbol] || { basePrice: 100 };
            let dataPoints, labels = [], prices = [];
            
            switch (timeRange) {
                case '1h':
                    dataPoints = 12;
                    for (let i = dataPoints; i >= 0; i--) {
                        const time = new Date(Date.now() - i * 5 * 60000);
                        labels.push(time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
                    }
                    break;
                case '1d':
                    dataPoints = 24;
                    for (let i = dataPoints; i >= 0; i--) {
                        const time = new Date(Date.now() - i * 60 * 60000);
                        labels.push(time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
                    }
                    break;
                case '1w':
                    dataPoints = 7;
                    for (let i = dataPoints; i >= 0; i--) {
                        const time = new Date(Date.now() - i * 24 * 60 * 60000);
                        labels.push(time.toLocaleDateString([], { month: 'short', day: 'numeric' }));
                    }
                    break;
                case '1m':
                    dataPoints = 30;
                    for (let i = dataPoints; i >= 0; i--) {
                        const time = new Date(Date.now() - i * 24 * 60 * 60000);
                        labels.push(time.toLocaleDateString([], { month: 'short', day: 'numeric' }));
                    }
                    break;
                case '6m':
                case '1y':
                    dataPoints = timeRange === '6m' ? 26 : 52;
                    for (let i = dataPoints; i >= 0; i--) {
                        const time = new Date(Date.now() - i * 7 * 24 * 60 * 60000);
                        labels.push(time.toLocaleDateString([], { month: 'short', day: 'numeric' }));
                    }
                    break;
                default:
                    dataPoints = 12;
            }
            
            // Generate price data with realistic fluctuations
            let basePrice = info.basePrice;
            for (let i = 0; i <= dataPoints; i++) {
                const volatility = 0.02; // 2% max change
                const change = (Math.random() - 0.5) * 2 * volatility;
                basePrice *= (1 + change);
                prices.push(parseFloat(basePrice.toFixed(2)));
            }
            
            return { labels, prices };
        }

        function generateMockStockData(symbol) {
            const info = stockInfo[symbol] || { 
                name: `${symbol} Inc.`, 
                basePrice: 100 + Math.random() * 200, 
                marketCap: 1e10 + Math.random() * 1e11, 
                volume: 1000000 + Math.random() * 10000000 
            };

            const randomFactor = 0.02; // 2% max fluctuation
            const priceChange = info.basePrice * (Math.random() * randomFactor * 2 - randomFactor);
            const price = info.basePrice + priceChange;
            const changePercent = (priceChange / info.basePrice) * 100;

            return {
                symbol: symbol,
                companyName: info.name,
                price: price,
                change: priceChange,
                changePercent: changePercent,
                volume: info.volume,
                marketCap: info.marketCap
            };
        }

        function formatMarketCap(marketCap) {
            if (marketCap >= 1e12) {
                return `${(marketCap / 1e12).toFixed(1)}T`;
            } else if (marketCap >= 1e9) {
                return `${(marketCap / 1e9).toFixed(1)}B`;
            } else if (marketCap >= 1e6) {
                return `${(marketCap / 1e6).toFixed(1)}M`;
            } else {
                return `${marketCap.toFixed(0)}`;
            }
        }

        function formatVolume(volume) {
            if (volume >= 1e6) {
                return `${(volume / 1e6).toFixed(1)}M`;
            } else if (volume >= 1e3) {
                return `${(volume / 1e3).toFixed(1)}K`;
            } else {
                return volume.toString();
            }
        }

        // Error handling
        window.addEventListener('error', function(event) {
            console.error('Uncaught error:', event.error);
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            // Cleanup any intervals or listeners
        });
    </script>
</body>
</html>
